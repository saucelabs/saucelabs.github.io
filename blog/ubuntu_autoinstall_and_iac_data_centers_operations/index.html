<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Ubuntu Autoinstall & IaC in Data Centers operations</title><link rel=alternate href=/index.xml type=application/atom+xml data-title="Sauce Labs Engineering Blog feed"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5"><meta name=description content="In this article, we will explain how Sauce Labs Data Center Operations Team has automated Ubuntu installations"><meta name=author content="Sauce Labs Open Source Program Office"><meta name=generator content="Hugo 0.66.0"><meta name=theme-color content="#AC1414"><link rel=manifest href=/site.webmanifest><link rel=preconnect href=https://www.google-analytics.com><link rel=stylesheet href=https://opensource.saucelabs.com/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://opensource.saucelabs.com/plugins/slick/slick.css><link rel=stylesheet href=https://opensource.saucelabs.com/plugins/themify-icons/themify-icons.css><link rel=stylesheet href=https://opensource.saucelabs.com/css/style.min.css media=screen><link rel="shortcut icon" href=https://opensource.saucelabs.com/images/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://opensource.saucelabs.com/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://opensource.saucelabs.com/images/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=https://opensource.saucelabs.com/images/apple-touch-icon.png><link rel=mask-icon color=#ac1414 href=https://opensource.saucelabs.com/images/safari-pinned-tab.svg><script src=https://cdn.cookielaw.org/scripttemplates/otSDKStub.js type=text/javascript data-domain-script=6d1eb79b-c89c-440f-87e8-dc9c37f0e44b></script><script type=text/javascript>function OptanonWrapper(){}</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-6735579-1"></script><script async src="https://platform-api.sharethis.com/js/sharethis.js#property=5f50fae56b5d9900194e28ff&product=inline-share-buttons"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-6735579-1');if('serviceWorker'in navigator){navigator.serviceWorker.register('/sw.js',{scope:'/'})}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"blog","name":"Ubuntu Autoinstall \x26 IaC in Data Centers operations","headline":"Ubuntu Autoinstall \x26 IaC in Data Centers operations","description":"In this article, we will explain how Sauce Labs Data Center Operations Team has automated Ubuntu installations","inLanguage":"en-US","author":"Daniel Louvier","creator":"Daniel Louvier","accountablePerson":"Daniel Louvier","copyrightHolder":"Daniel Louvier","copyrightYear":"2022","datePublished":"2022-01-14 09:00:00 \x2b0200 \x2b0200","publisher":"Sauce Labs","logo":"https://opensource.saucelabs.com/images/appicons/icon-128x128.png","url":"https:\/\/opensource.saucelabs.com\/blog\/ubuntu_autoinstall_and_iac_data_centers_operations\/","wordCount":"796","keywords":["ux","frontend","hackathon"]}</script><meta property="og:title" content="Ubuntu Autoinstall & IaC in Data Centers operations"><meta property="og:description" content="In this article, we will explain how Sauce Labs Data Center Operations Team has automated Ubuntu installations"><meta property="og:type" content="article"><meta property="og:url" content="https://opensource.saucelabs.com/blog/ubuntu_autoinstall_and_iac_data_centers_operations/"><meta property="og:image" content="https://opensource.saucelabs.com/images/blog/ubuntu-autoinstall-and-iac-data-centers-operations/github1.png"><meta property="article:published_time" content="2022-01-14T09:00:00+02:00"><meta property="article:modified_time" content="2022-01-14T09:00:00+02:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://opensource.saucelabs.com/images/blog/ubuntu-autoinstall-and-iac-data-centers-operations/github1.png"><meta name=twitter:title content="Ubuntu Autoinstall & IaC in Data Centers operations"><meta name=twitter:description content="In this article, we will explain how Sauce Labs Data Center Operations Team has automated Ubuntu installations"></head><body><div class=content-section><div class=preloader></div><header class="navigation fixed-top home-page"><nav class="navbar navbar-expand-lg navbar-dark home-page"><a class="navbar-brand invisible" id=home-page-logo href=https://opensource.saucelabs.com><img src=https://opensource.saucelabs.com/images/saucelabs_logo_white.svg alt="Sauce Labs Open Source"></a>
<a class="navbar-brand invisible" id=content-page-logo href=https://opensource.saucelabs.com><img src=https://opensource.saucelabs.com/images/saucelabs_logo_color.svg alt="Sauce Labs Open Source"></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navigation aria-controls=navigation aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto pt-4"><li class=nav-item><a class=nav-link href=https://opensource.saucelabs.com>Home</a></li><li class=nav-item><a class=nav-link href=https://opensource.saucelabs.com/projects>Projects</a></li><li class=nav-item><a class=nav-link href=https://opensource.saucelabs.com/docs>Docs</a></li><li class=nav-item><a class=nav-link href=https://opensource.saucelabs.com/blog>Blog</a></li></ul></div></nav></header><section class="page-title bg-primary position-relative overflow-hidden"><div class=container><div class=row><div class="col-12 text-center"><h1 class="text-white font-tertiary">Ubuntu Autoinstall & IaC in Data Centers operations</h1></div></div></div></section><section class=section><div class=container><div class=row><div class=col-lg-12><h3 class=font-tertiary>Ubuntu Autoinstall & IaC in Data Centers operations</h3><p class="font-secondary mb-5">Published on Jan 14, 2022
by
<span class=text-primary>Daniel Louvier</span></p><div class=content><h3 id=adopting-infrastructure-as-code-in-data-centers-operations>Adopting Infrastructure as Code in Data Centers Operations</h3><p>In this post, we will explain how Sauce Labs Data Center Operations Team has automated
Ubuntu installations using Cloud-Init and how to build a pipeline that creates USB
Provision Sticks to automatically install Ubuntu in nocloud environments.</p><h3 id=what-is-infrastructure-as-code>What is Infrastructure as Code?</h3><p>As per the Wikipedia definition, we can say Infrastructure as code (IaC) is the process
of managing and provisioning computer data centers through machine-readable definition files,
rather than physical hardware configuration or interactive configuration tools.</p><h3 id=why-infrastructure-as-code-is-important-for-sauce-labs>Why Infrastructure as Code is Important for Sauce Labs?</h3><p>In order to provide our Real Device Cloud (RDC), Sauce Labs maintains several data centers
with our own on-site staff. These teams work in several time zones and they are responsible
for the provision of the infrastructure which is the foundation of our real device cloud.</p><p>Having this foundation aligned is key to ensure reproducibility and traceability in any change
in our products and to plan future upgrades and expansions.</p><p>In this foundation, we have bare metals running Ubuntu. Traditionally we only have a few of
them, they were provisioned manually and we install them manually with USB Sticks. The whole
process required high human interaction.</p><p>As our Data Center team was expanded and working in different time zones we started to see
inconsistencies between the installation between these barebones, network changes were hard
to track too and all these inconsistencies caused issues when trying to apply global upgrades
or plan expansions.</p><h3 id=ubuntu-automating-installation>Ubuntu Automating Installation</h3><figure class=img-responsive><img src=/images/blog/ubuntu-autoinstall-and-iac-data-centers-operations/cloud-init-logo.png></figure><p>Cloud-init is the industry standard multi-distribution method for cross-platform
cloud instance initialization. It is supported across all major public cloud providers,
provisioning systems for private cloud infrastructure, and bare-metal installations.</p><p>To provision our barebones we use the <a href=https://cloudinit.readthedocs.io/en/latest/topics/datasources/nocloud.html>nocloud</a>
datasource passing the configuration via a second USB Stick labeled as “cidata”.</p><p>Check more information at <a href=https://ubuntu.com/server/docs/install/autoinstall-quickstart>https://ubuntu.com/server/docs/install/autoinstall-quickstart</a>.</p><h3 id=source-control-configurations>Source control configurations</h3><p>An example project to follow for this article is available in this GitHub Project:
<a href=https://github.com/dlouvier/ubuntu-autoinstall>ubuntu-autoinstall-example</a>.</p><p>Inside of the <code>configs</code> directory:</p><pre><code>configs
├── environments
│   ├── development
│   │   ├── devapp1.yaml
│   │   └── devapp2.yaml
│   └── production
│       ├── prodapp1.yaml
│       └── prodapp2.yaml
└── root_config.yaml
</code></pre><p>There are several <code>.yaml</code> files, e.g.:
<code>root_config.yaml</code> contains the general configuration, like the default user and ssh
configuration, which will apply to all the provision hosts.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>identity</span>:
    <span style=color:#66d9ef>hostname</span>: <span style=color:#e6db74>&#39;&#39;</span>
    <span style=color:#66d9ef>password</span>: <span style=color:#e6db74>&#39;${DEFAULT_USER_PASSWORD}&#39;</span>
    <span style=color:#66d9ef>username</span>: sysadmin

<span style=color:#75715e># (...)</span>

<span style=color:#66d9ef>ssh</span>:
    <span style=color:#66d9ef>install-server</span>: yes
    <span style=color:#66d9ef>allow-pw</span>: no
    <span style=color:#66d9ef>authorized-keys</span>:
        - <span style=color:#e6db74>&#39;${DEFAULT_USER_SSH_KEY}&#39;</span>
</code></pre></div><p>The files in environments directory e.g.: <code>environments/development/devapp2.yaml</code> contains
the specific configuration for a specific host:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>hostname</span>: devapp2

<span style=color:#66d9ef>ethernets</span>:
    <span style=color:#66d9ef>interface0</span>:
        <span style=color:#66d9ef>match</span>:
            <span style=color:#66d9ef>macaddress</span>: <span style=color:#e6db74>&#39;08:00:27:76:5C:C6&#39;</span>
        <span style=color:#66d9ef>set-name</span>: interface0
        <span style=color:#66d9ef>addresses</span>:
            - <span style=color:#ae81ff>10.0.2.15</span>/<span style=color:#ae81ff>24</span>
        <span style=color:#66d9ef>gateway4</span>: <span style=color:#ae81ff>10.0.2.2</span>
        <span style=color:#66d9ef>nameservers</span>:
            <span style=color:#66d9ef>addresses</span>:
                - <span style=color:#ae81ff>10.0.2.2</span>
</code></pre></div><p>The above configuration works in VirtualBox if you set in the network interface to have
the mac address: <code>08:00:27:76:5C:C6</code> or you can use devapp1 which just uses DHCP to assign
the address.</p><h3 id=iso-image-creation-via-pipeline>ISO Image creation via pipeline</h3><p>For this demonstration, the following pipeline is available in
<a href=https://github.com/dlouvier/ubuntu-autoinstall-example/actions>GitHub Actions</a> but it
can be implemented in any other CI/CD tool like Gitlab / Jenkins.</p><p>The configuration file is: <code>.github/workflows/build-cloud-init-iso-image.yml</code>.</p><p>In order to create the ISO image for the USB Stick to provision the host <strong>devapp1</strong>
we just need to go to <em>Actions</em> in our repository and select our workflow. After that run,
a manual workflow clicking in <em>Run workflow</em>. We will need to complete the fields <code>Hostname</code>
and <code>Environment</code>.</p><figure class=img-responsive><img src=/images/blog/ubuntu-autoinstall-and-iac-data-centers-operations/github1.png></figure><p>After clicking in <em>Run workflow</em> the pipeline will start:</p><figure class=img-responsive><img src=/images/blog/ubuntu-autoinstall-and-iac-data-centers-operations/github2.png></figure><p>Once the job has been completed, we will be able to download the ISO Image from the Github Actions UI:</p><figure class=img-responsive><img src=/images/blog/ubuntu-autoinstall-and-iac-data-centers-operations/github3.png></figure><h3 id=testing-our-iso-image>Testing our ISO Image</h3><p>Once we have the .zip file generated by GitHub actions we have two possibilities to test.</p><h4 id=using-virtualbox>Using VirtualBox</h4><p>We will need to configure VirtualBox with two optics units and in the first one use the
<strong>Ubuntu 20.04</strong> installation media and in the second one configure our just created ISO image.</p><figure class=img-responsive><img src=/images/blog/ubuntu-autoinstall-and-iac-data-centers-operations/vbox1.png></figure><p>After a few seconds, the installation will start and we will be able to see the automated
installation of Ubuntu.</p><figure class=img-responsive><img src=/images/blog/ubuntu-autoinstall-and-iac-data-centers-operations/vbox2.png></figure><h4 id=using-a-bare-metal>Using a bare metal</h4><p>For testing in real hardware, we will need to <em>burn</em> the ISO image into a USB Stick.
Depending on your OS you can use one of the following tools:</p><ul><li>Windows <a href=https://rufus.ie/en/>https://rufus.ie/en/</a></li><li>Linux: dd command. <a href=https://www.cyberciti.biz/faq/creating-a-bootable-ubuntu-usb-stick-on-a-debian-linux/>HowTo</a></li><li>macOS: <a href=https://www.balena.io/etcher/>BalenaEtcher</a></li></ul><p>After that, we need to plug both USB Sticks (one with the Ubuntu 20.04 media installation and another one
with our configuration) into the bare metal and select the Ubuntu 20.04 USB Stick to boot.</p><p>The Ubuntu installation will detect the second USB Stick labeled as “cidata” and it will start the installation.</p><h3 id=notes>Notes</h3><p>It is possible that the installation will prompt us to type <code>“yes”</code> to install Ubuntu using this
procedure. The way to bypass this is to remaster the Ubuntu 20.04 installation to media to set
<code>autoinstall</code> at the kernel boot options. Remastering is pretty straightforward using the
<a href=https://launchpad.net/cubic>Cubic</a> tool.</p><p>Post written by <a href=https://www.linkedin.com/in/daniellouvier/>Daniel Louvier</a></p></div></div><div class=sharethis><p>Please share!</p><div class=sharethis-inline-share-buttons></div></div></div></div></section></div><footer class="bg-dark footer-section"><div class=section><div class=container><div class=row><div class=col-md-3><h5 class=text-white><strong>Links</strong></h5><p class=footer-item-text><a href=https://opensource.saucelabs.com/projects class=footer-item-text>Projects</a></p><p class=footer-item-text><a href=https://opensource.saucelabs.com/docs class=footer-item-text>Docs</a></p><p class=footer-item-text><a href=https://opensource.saucelabs.com/blog class=footer-item-text>Blog</a></p></div><div class=col-md-3><h5 class=text-white><strong>Organizations</strong></h5><p class=footer-item-text><a href=https://www.w3.org/ class=footer-item-text rel=noreferrer target=_blank>W3C</a></p><p class=footer-item-text><a href=https://www.linuxfoundation.org/ class=footer-item-text rel=noreferrer target=_blank>Linux Foundation</a></p><p class=footer-item-text><a href=https://openjsf.org/ class=footer-item-text rel=noreferrer target=_blank>OpenJS Foundation</a></p><p class=footer-item-text><a href=https://sfconservancy.org/ class=footer-item-text rel=noreferrer target=_blank>SFC</a></p><p class=footer-item-text><a href=https://todogroup.org/ class=footer-item-text rel=noreferrer target=_blank>TODO Group</a></p><p class=footer-item-text><a href=https://mobilenativefoundation.org/ class=footer-item-text rel=noreferrer target=_blank>Mobile Native Foundation</a></p></div><div class=col-md-3><h5 class=text-white><strong>Connect with us</strong></h5><p class=footer-item-text><a href=https://saucelabs.com/ class=footer-item-text target=_blank rel=noreferrer><i class="ti-world icon-footer"></i>Website</a></p><p class=footer-item-text><a href=https://www.linkedin.com/company/sauce-labs/ class=footer-item-text target=_blank rel=noreferrer><i class="ti-linkedin icon-footer"></i>Sauce Labs</a></p><p class=footer-item-text><a href=https://github.com/saucelabs class=footer-item-text target=_blank rel=noreferrer><i class="ti-github icon-footer"></i>@saucelabs</a></p><p class=footer-item-text><a href=https://twitter.com/saucelabs/ class=footer-item-text target=_blank rel=noreferrer><i class="ti-twitter-alt icon-footer"></i>@saucelabs</a></p><p class=footer-item-text><a href=mailto:opensource@saucelabs.com class=footer-item-text target=_blank rel=noreferrer><i class="ti-email icon-footer"></i>opensource@saucelabs.com</a></p></div></div><div class="row pt-5"><div class=col-md-12><small class="mb-0 text-white">© 2020 Sauce Labs Inc., all rights reserved. SAUCE and SAUCE LABS are registered trademarks owned by Sauce Labs Inc. in the United States, EU, and may be registered in other jurisdictions.</small></div></div></div></div></footer><script rel=preload src=https://opensource.saucelabs.com/plugins/jQuery/jquery.min.js></script><script rel=preload src=https://opensource.saucelabs.com/plugins/bootstrap/bootstrap.min.js></script><script rel=preload src=https://opensource.saucelabs.com/plugins/slick/slick.min.js></script><script rel=preload src=https://opensource.saucelabs.com/plugins/shuffle/shuffle.min.js></script><script src=https://opensource.saucelabs.com/js/script.min.js></script></body></html>